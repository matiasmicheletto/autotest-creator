{"version":3,"sources":["app/custom/js/middleware.js","app/custom/js/middleware-db.js","app/custom/js/middleware-firestore.js","app/custom/js/app.js","app/controllers/home.js","app/controllers/autotest.js"],"names":["window","middleware","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","DEBUG","public","private","init","Promise","fulfill","reject","firebase","initializeApp","analytics","getStaticConfig","console","log","$","getJSON","err","getRemoteConfig","db","get","then","config","configTimestamp","Date","now","e","getTree","getStaticTree","result","getSortedLimited","snapshot","forEach","data","val","checkLocation","navigator","geolocation","getCurrentPosition","position","deltaX","coords","latitude","locationFilter","lat","deltaY","longitude","lng","range","Math","sqrt","msg","listen","path","callback_success","callback_error","database","ref","on","key","error","listenChild","child","value","orderByChild","equalTo","stopListener","off","once","getSorted","limit","limitToLast","query","set","update","push","pushMultiple","dataArray","job","k","all","fs","add","collection","firestore","docRef","document","doc","getCollection","querySnapshot","getDocument","id","operator","theQuery","where","querySortedLimited","orderBy","queryMultipleLimited","keys","operators","values","col","app","angular","module","$routeProvider","when","templateUrl","controller","resolve","check","$rootScope","$location","testAllowed","filter","$sce","trustAsResourceUrl","run","f7","Framework7","root","name","showPreloader","message","preloader","dialog","hidePreloader","opened","close","closePanel","panel","getElementById","showDialog","title","buttons","create","text","destroyOnClose","open","toastSuccess","timeout","toast","closeTimeout","cssClass","toastError","userAllowed","firstTest","logData","$apply","$scope","localData","localStorage","getItem","userData","JSON","parse","resetCheck","checkForm","age","dni","tel","gender","setItem","stringify","allowAutotest","results","limits","max","elapsed","logLimit","length","lastTimestamp","timestamp","round","onClick","actionStack","tree","current","treeID","index","loadMenu","exitCode","endTest","updAgeObj","FieldValue","increment","updGndrObj","updCodeObj","updPathObj","header","content","options","href","errorLog","errMsg","origin","err2"],"mappings":"AAAAA,OAAOC,WAAa,WAEhB,GAAIC,IACAC,OAAQ,0CACRC,WAAY,mCACZC,YAAa,0CACbC,UAAW,mBACXC,cAAe,+BACfC,kBAAmB,eACnBC,MAAO,4CACPC,cAAe,gBAGfC,GAAQ,EAERC,KACAC,IAkHJ,OAhHAD,GAAOE,KAAO,WACV,MAAO,IAAIC,SAAQ,SAAUC,EAASC,GAClC,IACIC,SAASC,cAAcjB,GACvBgB,SAASE,WAMT,IAAIC,GAAkB,WACdV,GAAOW,QAAQC,IAAI,qCACvBC,EAAEC,QAAQ,qBACNT,EACA,SAAUU,GACN,MAAOT,GAAOS,MAKtBC,EAAkB,WAClBf,EAAOgB,GAAGC,IAAI,UACTC,KAAK,SAAUC,GACRA,GACAlB,EAAQkB,OAASA,EACjBlB,EAAQmB,gBAAkBC,KAAKC,MAC3BvB,GAAOW,QAAQC,IAAI,gCACvBP,EAAQe,IAERV,MARZT,SAUW,SAAUc,GACTf,GAAOW,QAAQC,IAAIG,GACvBL,MAIPR,GAAQkB,QAGLE,KAAKC,MAAQrB,EAAQmB,gBAAkB,MACnCrB,GAAOW,QAAQC,IAAI,mCACvBP,EAAQH,EAAQkB,SAJpBJ,IASN,MAAOQ,GACL,MAAOlB,GAAOkB,OAK1BvB,EAAOwB,QAAU,WACb,MAAO,IAAIrB,SAAQ,SAAUC,EAASC,GAElC,GAAIoB,GAAgB,WAChBb,EAAEC,QAAQ,mBAAoB,SAAUa,GAEpC,MADI3B,IAAOW,QAAQC,IAAIe,GAChBtB,EAAQsB,IAChB,SAAUZ,GACT,MAAOT,GAAOS,KAItBd,GAAOgB,GAAGW,iBAAiB,gBAAiB,YAAa,GACpDT,KAAK,SAAUU,GACZA,EAASC,QAAQ,SAAUC,GAEvB,MADI/B,IAAOW,QAAQC,IAAImB,EAAKC,OACrB3B,EAAQ0B,EAAKC,WAJhC/B,SAOW,SAAUc,GACTf,GAAOW,QAAQC,IAAIG,GACvBW,SAKhBzB,EAAOgC,cAAgB,SAAUb,GAC7B,MAAO,IAAIhB,SAAQ,SAAUC,EAASC,GAClC,MAAI4B,WAAUC,gBACVD,WAAUC,YAAYC,mBAAmB,SAAUC,GAE/C,GAAIC,GAASD,EAASE,OAAOC,SAAWpB,EAAOqB,eAAeC,IAC1DC,EAASN,EAASE,OAAOK,UAAYxB,EAAOqB,eAAeI,IAC3DC,EAAQC,KAAKC,KAAKV,EAASA,EAASK,EAASA,EAQjD,OANI3C,KACAW,QAAQC,IAAI,iBAAmByB,EAASE,OAAOC,SAAW,YAAcH,EAASE,OAAOK,WACxFjC,QAAQC,IAAI,iBAAmBQ,EAAOqB,eAAeC,IAAM,YAActB,EAAOqB,eAAeI,KAC/FlC,QAAQC,IAAI,cAAgBkC,IAG5BA,EAAQ1B,EAAOqB,eAAeK,MACvBzC,GACHqC,IAAKL,EAASE,OAAOC,SACrBK,IAAKR,EAASE,OAAOK,YAGlBtC,GACH2C,IAAK,4BAIV3C,GACH2C,IAAK,wCAMdhD;CClIX,SAAWA,GAEPA,EAAOgB,MAEPhB,EAAOgB,GAAGiC,OAAS,SAAUC,EAAMC,EAAkBC,GACjD9C,SAAS+C,WAAWC,IAAIJ,GAAMK,GAAG,QAC7B,SAAU3B,GACNuB,EAAiBvB,EAASG,MAAOH,EAAS4B,MAE9C,SAAUC,GACNL,EAAeK,MAI3BzD,EAAOgB,GAAG0C,YAAc,SAASR,EAAMS,EAAOC,EAAOT,EAAkBC,GACnE9C,SAAS+C,WAAWC,IAAIJ,GAAMW,aAAaF,GAAOG,QAAQF,GAAOL,GAAG,cAChE,SAAU3B,GACNuB,EAAiBvB,EAASG,MAAOH,EAAS4B,MAE9C,SAAUC,GACNL,EAAeK,MAI3BzD,EAAOgB,GAAG+C,aAAe,SAASb,GAC9B,MAAO,IAAI/C,SAAQ,SAAUC,EAASC,GAClCC,SAAS+C,WAAWC,IAAIJ,GAAMc,MACzB9C,KAAK,WACF,MAAOd,OAFfE,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAOgB,GAAGC,IAAM,SAAUiC,GACtB,MAAO,IAAI/C,SAAQ,SAAUC,EAASC,GAClCC,SAAS+C,WAAWC,IAAIJ,GAAMe,KAAK,SAC9B/C,KAAK,SAAUU,GACZ,MAAOxB,GAAQwB,EAASG,SAFhCzB,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAOgB,GAAGkD,UAAY,SAAUhB,EAAMM,GAClC,MAAO,IAAIrD,SAAQ,SAAUC,EAASC,GAClCC,SAAS+C,WAAWC,IAAIJ,GAAMW,aAAaL,GAAKS,KAAK,SAChD/C,KAAK,SAAUU,GACZ,MAAOxB,GAAQwB,KAFvBtB,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAOgB,GAAGW,iBAAmB,SAAUuB,EAAMM,EAAKW,GAC9C,MAAO,IAAIhE,SAAQ,SAAUC,EAASC,GAClCC,SAAS+C,WAAWC,IAAIJ,GAAMW,aAAaL,GAAKY,YAAYD,GAAOF,KAAK,SACnE/C,KAAK,SAAUU,GACZ,MAAOxB,GAAQwB,KAFvBtB,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAOgB,GAAGqD,MAAQ,SAASnB,EAAMM,EAAKI,GAClC,MAAO,IAAIzD,SAAQ,SAAUC,EAASC,GAClCC,SAAS+C,WAAWC,IAAIJ,GAAMW,aAAaL,GAAKM,QAAQF,GAAOK,KAAK,SAC/D/C,KAAK,SAAUU,GACZ,MAAOxB,GAAQwB,KAFvBtB,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAOgB,GAAGsD,IAAM,SAAUxC,EAAMoB,GAC5B,MAAO,IAAI/C,SAAQ,SAAUC,EAASC,GAClCC,SAAS+C,WAAWC,IAAIJ,GAAMoB,IAAIxC,GAC7BZ,KAAK,SAAUU,GACZ,MAAOxB,GAAQwB,KAFvBtB,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAOgB,GAAGuD,OAAS,SAAUzC,EAAMoB,GAC/B,MAAO,IAAI/C,SAAQ,SAAUC,EAASC,GAClCC,SAAS+C,WAAWC,IAAIJ,GAAMqB,OAAOzC,GAChCZ,KAAK,SAAUU,GACZ,MAAOxB,GAAQwB,KAFvBtB,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAOgB,GAAGwD,KAAO,SAAU1C,EAAMoB,GAC7B,MAAO,IAAI/C,SAAQ,SAAUC,EAASC,GAClCC,SAAS+C,WAAWC,IAAIJ,GAAMsB,KAAK1C,GAC9BZ,KAAK,SAAUU,GACZ,MAAOxB,GAAQwB,KAFvBtB,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAOgB,GAAGyD,aAAe,SAAUC,EAAWxB,GAC1C,MAAO,IAAI/C,SAAQ,SAAUC,EAASC,GAClC,GAAIsE,KACJ,KAAK,GAAIC,KAAKF,GACVC,EAAIH,KAAKlE,SAAS+C,WAAWC,IAAIJ,GAAMsB,KAAKE,EAAUE,IAC1DzE,SAAQ0E,IAAIF,GACPzD,KAAK,SAAUU,GACZ,MAAOxB,GAAQwB,KAFvBzB,SAIW,SAAUsD,GACb,MAAOpD,GAAOoD,SAK/BpE;CCvIH,SAAUW,GAENA,EAAO8E,MAEP9E,EAAO8E,GAAGC,IAAM,SAAUjD,EAAMkD,GAC5B,MAAO,IAAI7E,SAAQ,SAAUC,EAASC,GAClCC,SAAS2E,YAAYD,WAAWA,GAAYD,IAAIjD,GAC3CZ,KAAK,SAAUgE,GACZ,MAAO9E,GAAQ8E,KAFvB5E,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAO8E,GAAGR,IAAM,SAAUxC,EAAMkD,EAAYG,GACxC,MAAO,IAAIhF,SAAQ,SAAUC,EAASC,GAClCC,SAAS2E,YAAYD,WAAWA,GAAYI,IAAID,GAAUb,IAAIxC,GACzDZ,KAAK,WACF,MAAOd,OAFfE,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAO8E,GAAGP,OAAS,SAASzC,EAAMkD,EAAYG,GAC1C,MAAO,IAAIhF,SAAQ,SAAUC,EAASC,GAClCC,SAAS2E,YAAYD,WAAWA,GAAYI,IAAID,GAAUZ,OAAOzC,GAC5DZ,KAAK,WACF,MAAOd,OAFfE,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAO8E,GAAP9E,UAAmB,SAASgF,EAAYG,GACpC,MAAO,IAAIhF,SAAQ,SAAUC,EAASC,GAClCC,SAAS2E,YAAYD,WAAWA,GAAYI,IAAID,GAAhD7E,YACKY,KAAK,WACF,MAAOd,OAFfE,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAO8E,GAAGO,cAAgB,SAAUL,GAChC,MAAO,IAAI7E,SAAQ,SAAUC,EAASC,GAClCC,SAAS2E,YAAYD,WAAWA,GAAY/D,MACvCC,KAAK,SAAUoE,GACZ,MAAOlF,GAAQkF,KAFvBhF,SAIW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAO8E,GAAGS,YAAc,SAASP,EAAWG,GACxC,MAAO,IAAIhF,SAAQ,SAAUC,EAASC,GAClCC,SAAS2E,YAAYD,WAAWA,GAAYI,IAAID,GAAUlE,MACrDC,KAAK,SAAUoE,GACZ,GAAIxD,GAAOwD,EAAcxD,MAEzB,OADAA,GAAK0B,IAAM8B,EAAcE,GAClBpF,EAAQ0B,KAJvBxB,SAMW,SAAUmD,GACb,MAAOpD,GAAOoD,QAS9BzD,EAAO8E,GAAGT,MAAQ,SAAUW,EAAYxB,EAAKiC,EAAU7B,EAAOO,GAC1D,MAAO,IAAIhE,SAAQ,SAAUC,EAASC,GAClC,GACIqF,GADAhE,IAGAgE,GADDvB,EACY7D,SAAS2E,YAAYD,WAAWA,GAAYW,MAAMnC,EAAKiC,EAAU7B,GAAOO,MAAMA,GAE9E7D,SAAS2E,YAAYD,WAAWA,GAAYW,MAAMnC,EAAKiC,EAAU7B,GAEhF8B,EAASzE,MACJC,KAAK,SAAUoE,GAMZ,MALAA,GAAczD,QAAQ,SAAUuD,GAC5B,GAAItD,GAAOsD,EAAItD,MACfA,GAAK0B,IAAM4B,EAAII,GACf9D,EAAO8C,KAAK1C,KAET1B,EAAQsB,KAPvBgE,SASW,SAAUjC,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAO8E,GAAGc,mBAAqB,SAAUZ,EAAYxB,EAAKiC,EAAU7B,EAAOiC,EAAS1B,GAChF,MAAO,IAAIhE,SAAQ,SAAUC,EAASC,GAClC,GAAIqB,KACJpB,UAAS2E,YAAYD,WAAWA,GAAYW,MAAMnC,EAAKiC,EAAU7B,GAAOiC,QAAQA,EAAS,QAAQ1B,MAAMA,GAAOlD,MACzGC,KAAK,SAAUoE,GAMZ,MALAA,GAAczD,QAAQ,SAAUuD,GAC5B,GAAItD,GAAOsD,EAAItD,MACfA,GAAK0B,IAAM4B,EAAII,GACf9D,EAAO8C,KAAK1C,KAET1B,EAAQsB,KAPvBpB,SASW,SAAUmD,GACb,MAAOpD,GAAOoD,QAK9BzD,EAAO8E,GAAGgB,qBAAuB,SAASd,EAAYe,EAAMC,EAAWC,EAAQ9B,GAC3E,MAAO,IAAIhE,SAAQ,SAAUC,EAASC,GAClC,GAAIqB,MACAwE,EAAM5F,SAAS2E,YAAYD,WAAWA,EAC1C,KAAI,GAAIJ,KAAKmB,GACTG,EAAMA,EAAIP,MAAMI,EAAKnB,GAAIoB,EAAUpB,GAAIqB,EAAOrB,GAClDsB,GAAI/B,MAAMA,GAAOlD,MACZC,KAAK,SAAUoE,GAMZ,MALAA,GAAczD,QAAQ,SAAUuD,GAC5B,GAAItD,GAAOsD,EAAItD,MACfA,GAAK0B,IAAM4B,EAAII,GACf9D,EAAO8C,KAAK1C,KAET1B,EAAQsB,KAPvBwE,SASW,SAAUzC,GACb,MAAOpD,GAAOoD,SAK/BpE;ACjJH,GAAI8G,KAAMC,QAAQC,OAAO,YAAa,UAAW,eAC5ClF,QAAQ,iBAAkB,SAAUmF,GACjCA,EACKC,KAAK,KACFC,YAAa,kBACbC,WAAY,SAEfF,KAAK,aACFC,YAAa,sBACbC,WAAY,WACZC,SACIC,OAAQ,aAAc,YAAa,SAAUC,EAAYC,GACjDD,EAAWE,YACXD,EAAU3D,KAAK,aAEf2D,EAAU3D,KAAK,UAI9BqD,KAAK,UACFC,YAAa,qBAEhBD,KAAK,eACFC,YAAa,6BAGxBO,OAAO,WAAY,OAAQ,SAAUC,GAElC,MAAOA,GAAKC,sBAEfC,KAAK,aAAc,SAAUN,GAG1B,GAAIO,GAAK,GAAIC,aACTC,KAAM,OACNC,KAAM,uBACN9B,GAAI,8BACJY,SAAS,GAGbQ,GAAWW,cAAgB,SAAUC,GACjCZ,EAAWa,UAAYN,EAAGO,OAAOD,UAAUD,EAAS,SAGxDZ,EAAWe,cAAgB,WACnBf,EAAWa,UAAUG,QACrBhB,EAAWa,UAAUI,SAG7BjB,EAAWkB,WAAa,WACpBX,EAAGY,MAAMF,MAAM1C,SAAS6C,eAAe,eAAe,IAG1DpB,EAAWqB,WAAa,SAASC,EAAOV,EAASW,GAC7ChB,EAAGO,OAAOU,QACNF,MAAOA,EACPG,KAAMb,EACNW,QAASA,EACTG,gBAAgB,IACjBC,QAGP3B,EAAW4B,aAAe,SAAUhB,EAASiB,EAASrG,GAClD+E,EAAGuB,MAAMN,QACLC,KAAMb,EACNpF,SAAUA,GAAY,SACtBuG,aAAcF,GAAW,IACzBH,gBAAgB,EAChBM,SAAU,kBACXL,QAGP3B,EAAWiC,WAAa,SAAUrB,EAASiB,EAASrG,GAChD+E,EAAGuB,MAAMN,QACLC,KAAMb,EACNpF,SAAUA,GAAY,SACtBuG,aAAcF,GAAW,IACzBH,gBAAgB,EAChBM,SAAU,gBACXL,QAGP3B,EAAWkC,aAAc,EACzBlC,EAAWE,aAAc,EACzBF,EAAWmC,WAAY,EAGvBnC,EAAWW,cAAc,eACzBlI,WAAWa,OACNgB,KAAK,SAAUC,GACZT,QAAQC,IAAIQ,GACZyF,EAAWzF,OAASA,EACpByF,EAAWe,gBAGXf,EAAWoC,WACXpC,EAAWW,cAAc,6BACzBlI,WAAW2C,cAAc4E,EAAWzF,QAC/BD,KAAK,SAAUQ,GACZkF,EAAWe,gBAGXf,EAAWoC,QAAQvG,IAAMf,EAAOe,IAChCmE,EAAWoC,QAAQpG,IAAMlB,EAAOkB,IAEhCgE,EAAWkC,aAAc,EAEzBlC,EAAW4B,aAAa,8CACxB5B,EAAWqC,WAXnB5J,SAaW,SAAUyB,GACbJ,QAAQC,IAAIG,GACZ8F,EAAWe,gBACXf,EAAWiC,WAAW,gDACtBjC,EAAWqC,aA1B3B5J,SA6BW,SAAUyB,GACbJ,QAAQC,IAAIG;ACtH5BqF,IAAIM,WAAW,QAAS,SAAU,aAAc,SAAUyC,EAAQtC,GAG9DA,EAAWE,aAAc,CAGzB,IAAIqC,GAAYC,aAAaC,QAAQ,WACrC3I,SAAQC,IAAIwI,GACTA,EACCD,EAAOI,SAAWC,KAAKC,MAAML,GAE7BD,EAAOI,YAGXJ,EAAOO,WAAa,WAChB7C,EAAWE,aAAc,GAG7BoC,EAAOQ,UAAY,WAEf,IAAI9C,EAAWE,YAAY,CAGvB,IAAKoC,EAAOI,SAER,WADA1C,GAAWiC,WAAW,2BAI1B,KAAKK,EAAOI,SAAShC,KAEjB,WADAV,GAAWiC,WAAW,2BAI1B,KAAKK,EAAOI,SAASK,IAEjB,WADA/C,GAAWiC,WAAW,6BAI1B,KAAKK,EAAOI,SAASM,IAEjB,WADAhD,GAAWiC,WAAW,wBAGtB,IAAIK,EAAOI,SAASM,IAAM,IAEtB,WADAhD,GAAWiC,WAAW,oCAK9B,KAAKK,EAAOI,SAASO,IAEjB,WADAjD,GAAWiC,WAAW,iCAI1B,KAAKK,EAAOI,SAASQ,OAEjB,WADAlD,GAAWiC,WAAW,yBAK1BO,cAAaW,QAAQ,WAAYR,KAAKS,UAAUd,EAAOI,UASvD,IAAIW,GAAgB,WAChB,IAAI,GAAIrF,KAAKsE,GAAOI,SAChBJ,EAAOF,QAAQpE,GAAKsE,EAAOI,SAAS1E,EACxCgC,GAAWE,aAAc,EACzBF,EAAW4B,aAAa,sCAAuC,KAAM,UACrE5B,EAAWqC,SAGfrC,GAAWW,cAAc,wBACzBlI,WAAWyF,GAAGT,MAAM,UAAW,MAAO,KAAM6E,EAAOI,SAASM,IAAK,GAChE1I,KAAK,SAASgJ,GACXtD,EAAWe,eAEX,IAAIwC,IACAC,IAAK,EACLC,QAAS,MAQb,IANGzD,EAAWzF,QACPyF,EAAWzF,OAAOmJ,WACjBH,GACIC,IAAKxD,EAAWzF,OAAOmJ,SAASF,IAChCC,QAASzD,EAAWzF,OAAOmJ,SAASD,UAE7CH,EAAQK,QAAUJ,EAAOC,IACxBxD,EAAWqB,WAAW,uBAClB,2CAA2CkC,EAAOC,IAAI,2BACpD/B,KAAK,iBAGX,IAAqB,GAAlB6B,EAAQK,OACP3D,EAAWmC,WAAY,EACvBkB,QACC,CAED,GAAIO,GAAgB,CACpB,KAAI,GAAI5F,KAAKsF,GACNA,EAAQtF,GAAG6F,UAAYD,IACtBA,EAAgBN,EAAQtF,GAAG6F,UAEhCpJ,MAAKC,MAAQkJ,EAAgBL,EAAOE,QACnCzD,EAAWqB,WAAW,uBAClB,oBAAoBnF,KAAK4H,MAAM9D,EAAWzF,OAAOmJ,SAASD,QAAQ,MAAS,6EACzEhC,KAAK,aAGXzB,EAAWqB,WAAW,2BAClB,kCAAkCiC,EAAQK,OAAO,qDAE7ClC,KAAM,UACNsC,QAAS,WACLV,WAzC5B5K,SAiDO,SAAUyB,GACbJ,QAAQC,IAAIG,GACZ8F,EAAWe,gBACXf,EAAWqC;ACjI3B9C,IAAIM,WAAW,YAAa,SAAU,aAAc,SAAUyC,EAAQtC,GAIlEA,EAAWW,cAAc,uBAEzBX,EAAWoC,QAAQ4B,eAEnBvL,WAAWmC,UACVN,KAAK,SAASC,GACXyF,EAAWe,gBAEXuB,EAAO2B,KAAO1J,EAAO0J,KACrB3B,EAAO4B,QAAU3J,EAAO0J,KAAK,GAC7BjE,EAAWoC,QAAQ+B,OAAS5J,EAAOqE,GACnCoB,EAAWoC,QAAQ4B,YAAYpG,MAC3BwG,MAAO,IACPP,UAAWpJ,KAAKC,QAGpBsF,EAAWqC,WAZf5J,SAcO,SAASyB,GACZJ,QAAQC,IAAIG,KAGhBoI,EAAO+B,SAAW,SAAUD,EAAOE,GAC5BA,IACCtE,EAAWoC,QAAQkC,SAAWA,GACtB,IAATF,EACC9B,EAAOiC,UAEHjC,EAAO2B,KAAKG,KACZpE,EAAWoC,QAAQ4B,YAAYpG,MAC3BwG,MAAOA,EACPP,UAAWpJ,KAAKC,QAEpB4H,EAAO4B,QAAU5B,EAAO2B,KAAKG,KAKzC9B,EAAOiC,QAAU,WAMb,GALAvE,EAAWoC,QAAQyB,UAAYpJ,KAAKC,MAEpCsF,EAAWW,cAAc,0BAGtBX,EAAWmC,UAAU,CACpB,GAAIY,GAAM/C,EAAWoC,QAAQW,IACzByB,IACJA,GAAU,UAAWzB,EAAMA,EAAM,IAAI,IAAOrJ,SAAS2E,UAAUoG,WAAWC,UAAU,EAEpF,IAAIC,KACJA,GAAW3E,EAAWoC,QAAQc,QAAUxJ,SAAS2E,UAAUoG,WAAWC,UAAU,GAEhFjM,WAAWyF,GAAGP,OAAO6G,EAAU,QAAQ,QACvC/L,WAAWyF,GAAGP,OAAOgH,EAAW,QAAQ,WAG5C,GAAIC,KACJA,GAAW5E,EAAWoC,QAAQkC,UAAY5K,SAAS2E,UAAUoG,WAAWC,UAAU,EAElF,IAAIG,KACJA,GAAW7E,EAAWoC,QAAQ+B,UAE9B,KAAI,GADA7H,GAAO,MACH0B,EAAI,EAAGA,EAAIgC,EAAWoC,QAAQ4B,YAAYL,OAAQ3F,IACtD1B,GAAQ,IAAI0D,EAAWoC,QAAQ4B,YAAYhG,GAAGoG,MAC9CS,EAAW7E,EAAWoC,QAAQ+B,QAAQ7H,GAAQ5C,SAAS2E,UAAUoG,WAAWC,UAAU,GACtFpI,EAAO,KAAK0D,EAAWoC,QAAQ4B,YAAYhG,GAAGoG,KAElD3L,YAAWyF,GAAGP,OAAOiH,EAAW,QAAQ,aACxCnM,WAAWyF,GAAGP,OAAOkH,EAAW,QAAQ,SAIxCpM,WAAWyF,GAAGC,IAAI6B,EAAWoC,QAAS,WACjC9H,KAAK,WAEFgI,EAAO4B,SACHY,OAAQ,gCACRC,QAAS,uEAAuE7I,KAAK4H,MAAM9D,EAAWzF,OAAOmJ,SAASD,QAAQ,MAAS,UACvIuB,UAEQvD,KAAK,iBACLwD,KAAK,SAIjBjF,EAAWe,gBACXuB,EAAOD,WAdf5J,SAgBW,SAASyB,GACZJ,QAAQC,IAAIG,GAEZoI,EAAO4B,SACHY,OAAQ,mCACRC,QAAS,+FACTC,UAEQvD,KAAK,iBACLwD,KAAK,QAIjB,IAAIC,IACAC,OAAQxC,KAAKS,UAAUlJ,GACvB2J,UAAWpJ,KAAKC,MAChB0K,OAAQ,6BAEZ3M,YAAWyF,GAAGC,IAAI+G,EAAU,aACvB5K,KAAK,WACF0F,EAAWe,gBACXuB,EAAOD,WAHf5J,SAKW,SAAS4M,GACZvL,QAAQC,IAAIsL,GACZrF,EAAWe,gBACXuB,EAAOD","file":"main-bda7727674.js","sourcesContent":["window.middleware = (function () {\n\n    var firebaseConfig = { // Configuracion firebase\n        apiKey: \"AIzaSyDcBhhiu-dQXWaGBLcTEtnz8HPnelfXuA4\",\n        authDomain: \"covid19-autotest.firebaseapp.com\",\n        databaseURL: \"https://covid19-autotest.firebaseio.com\",\n        projectId: \"covid19-autotest\",\n        storageBucket: \"covid19-autotest.appspot.com\",\n        messagingSenderId: \"541298094681\",\n        appId: \"1:541298094681:web:a715a3322843f6ff7e7748\",\n        measurementId: \"G-0YZX1RVB1F\"\n    };\n\n    var DEBUG = true; // Version debugging\n\n    var public = {}; // Metodos y atributos publicos\n    var private = {}; // Metodos y atributos privados\n\n    public.init = function () { // Inicializacion del middleware. Descarga de configuracion\n        return new Promise(function (fulfill, reject) {\n            try {\n                firebase.initializeApp(firebaseConfig);\n                firebase.analytics();\n\n                // Descarga de parametros de configuracion\n                // Se intenta descargar la configuracion de firebase (se usa un cache local por una hora)\n                // Si no se logra descargar la configuracion de firebase, se descarga una del server host\n\n                var getStaticConfig = function () { // Leer configuracion del server host\n                    if (DEBUG) console.log(\"Recurso de configuracion: hosting\");\n                    $.getJSON(\"custom/config.json\",\n                        fulfill, // Pasar directamente a la verificacion \n                        function (err) {\n                            return reject(err);\n                        }\n                    );\n                };\n\n                var getRemoteConfig = function () { // Leer configuracion de firebase o en caso de error traer del hosting\n                    public.db.get(\"config\") // Descargar configuracion de firebase\n                        .then(function (config) { // Callback\n                            if (config) { // Hay datos\n                                private.config = config; // Cachear la descarga\n                                private.configTimestamp = Date.now();\n                                if (DEBUG) console.log(\"Recurso de configuracion: DB\");\n                                fulfill(config) // Verificar\n                            } else // Si no hay datos, usar version statica\n                                getStaticConfig();\n                        })\n                        .catch(function (err) { // Ante error de consulta (puede ser por permisos)\n                            if (DEBUG) console.log(err);\n                            getStaticConfig(); // Tomar datos de la configuracion estatica\n                        });\n                };\n\n                if (!private.config) { // Si no hay ninguna configuracion guardada en variable\n                    getRemoteConfig(); // Intentar descargar de firebase\n                } else { // Si hay una guardada, verificar antiguedad\n                    if (Date.now() - private.configTimestamp < 3600000) { // Si paso menos de una hora de la ultima descarga, usar la que esta\n                        if (DEBUG) console.log(\"Recurso de configuracion: cache\");\n                        fulfill(private.config);\n                    } else { // Si tiene mas de una hora, intentar descargar una nueva\n                        getRemoteConfig();\n                    }\n                }\n            } catch (e) {\n                return reject(e);\n            }\n        });\n    };\n\n    public.getTree = function () { // Leer arbol de decision desde hosting\n        return new Promise(function (fulfill, reject) {\n\n            var getStaticTree = function () { // Descargar version de hosting\n                $.getJSON(\"custom/tree.json\", function (result) {\n                    if (DEBUG) console.log(result);\n                    return fulfill(result);\n                }, function (err) {\n                    return reject(err);\n                });\n            };\n\n            public.db.getSortedLimited(\"decisionTrees\", \"timestamp\", 1)\n                .then(function (snapshot) {\n                    snapshot.forEach(function (data) {\n                        if (DEBUG) console.log(data.val());\n                        return fulfill(data.val());\n                    })\n                })\n                .catch(function (err) { // Ante error de consulta (puede ser por permisos)\n                    if (DEBUG) console.log(err);\n                    getStaticTree(); // Tomar datos del archivo de hosting\n                });\n        });\n    };\n\n    public.checkLocation = function (config) { // Obtener posiscion del cliente y comparar con filtro de configuracion\n        return new Promise(function (fulfill, reject) {\n            if (navigator.geolocation) {\n                navigator.geolocation.getCurrentPosition(function (position) {\n                    // Determinar distancia al centro del area\n                    var deltaX = position.coords.latitude - config.locationFilter.lat;\n                    var deltaY = position.coords.longitude - config.locationFilter.lng;\n                    var range = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n\n                    if (DEBUG) {\n                        console.log(\"Filtro: Lat.: \" + position.coords.latitude + \" -- Lng: \" + position.coords.longitude);\n                        console.log(\"Cliente: Lat: \" + config.locationFilter.lat + \" -- Lng: \" + config.locationFilter.lng);\n                        console.log(\"Distancia: \" + range);\n                    }\n\n                    if (range < config.locationFilter.range) // Si esta dentro de rango, retornar posicion\n                        return fulfill({\n                            lat: position.coords.latitude,\n                            lng: position.coords.longitude\n                        });\n                    else // Si no pertenece al area de analisis\n                        return reject({\n                            msg: \"Usuario fuera de area\"\n                        });\n                });\n            } else {\n                return reject({\n                    msg: \"No se pudo determinar ubicación.\"\n                });\n            }\n        });\n    };\n\n    return public;\n})();","(function (public) { // Extension de funciones middleware: realtime database\n\n    public.db = {}; // Metodos de realtime database\n\n    public.db.listen = function (path, callback_success, callback_error) { // Escuchar cambios\n        firebase.database().ref(path).on('value',\n            function (snapshot) {\n                callback_success(snapshot.val(), snapshot.key);\n            },\n            function (error) {\n                callback_error(error);\n            });\n    };\n\n    public.db.listenChild = function(path, child, value, callback_success, callback_error) { // Escucha cambios con filtro\n        firebase.database().ref(path).orderByChild(child).equalTo(value).on('child_added',\n            function (snapshot) {\n                callback_success(snapshot.val(), snapshot.key);\n            },\n            function (error) {\n                callback_error(error);\n            });\n    };\n\n    public.db.stopListener = function(path){ // Detener escuchador\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).off()\n                .then(function () {\n                    return fulfill();\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.get = function (path) { // Descargar tabla de la db\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).once('value')\n                .then(function (snapshot) {\n                    return fulfill(snapshot.val());\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.getSorted = function (path, key) { // Obtener lista ordenada por key\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).orderByChild(key).once('value')\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.getSortedLimited = function (path, key, limit) { // Obtener lista ordenada por key y con limite de entradas\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).orderByChild(key).limitToLast(limit).once('value')\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.query = function(path, key, value) { // Consulta por valor\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).orderByChild(key).equalTo(value).once('value')\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.set = function (data, path) { // Actualizar entrada de la db\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).set(data)\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.update = function (data, path) { // Actualizar entrada de la db\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).update(data)\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.push = function (data, path) { // Nueva entrada (retorna id)\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).push(data)\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.pushMultiple = function (dataArray, path) { // Subir multiples entradas a un mismo directorio\n        return new Promise(function (fulfill, reject) {\n            var job = [];\n            for (var k in dataArray) // Para cada objeto \n                job.push(firebase.database().ref(path).push(dataArray[k])); // TODO: usar multiples paths \n            Promise.all(job) // Ejecutar promise\n                .then(function (snapshot) { // Snapshot es un array que contiene los keys\n                    return fulfill(snapshot); // Del otro lado se puede hacer un for para retornar\n                })\n                .catch(function (error) { // Ver si retorna un solo error o varios\n                    return reject(error);\n                });\n        });\n    };\n\n})(middleware);","(function(public){ // Extension de funciones middleware: firestore\n\n    public.fs = {}; // Metodos de firestore\n\n    public.fs.add = function (data, collection) { // Agregar un documento a la collection\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).add(data)\n                .then(function (docRef) {\n                    return fulfill(docRef); // docRef.id tiene el id del document cargado\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.set = function (data, collection, document) { // Asignar objeto al document de una collection\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).doc(document).set(data)\n                .then(function () {\n                    return fulfill();\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.update = function(data, collection, document) { // Actualizar datos existentes\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).doc(document).update(data)\n                .then(function () {\n                    return fulfill();\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.delete = function(collection, document) { // Actualizar datos existentes\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).doc(document).delete()\n                .then(function () {\n                    return fulfill();\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.getCollection = function (collection) { // Descargar collection\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).get()\n                .then(function (querySnapshot) {\n                    return fulfill(querySnapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.getDocument = function(collection,document){\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).doc(document).get()\n                .then(function (querySnapshot) {\n                    var data = querySnapshot.data();\n                    data.key = querySnapshot.id;\n                    return fulfill(data);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n\n    ///// Consultas //////\n    // Los resultados retornan como arrays y las claves van como atributo \"key\" de cada elemento\n\n    public.fs.query = function (collection, key, operator, value, limit) { // Consulta por campos de documents\n        return new Promise(function (fulfill, reject) {\n            var result = [];\n            var theQuery;\n            if(limit)\n                theQuery = firebase.firestore().collection(collection).where(key, operator, value).limit(limit);\n            else\n                theQuery = firebase.firestore().collection(collection).where(key, operator, value);\n            \n            theQuery.get()\n                .then(function (querySnapshot) {\n                    querySnapshot.forEach(function (doc) {\n                        var data = doc.data();\n                        data.key = doc.id;\n                        result.push(data);\n                    });\n                    return fulfill(result);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.querySortedLimited = function (collection, key, operator, value, orderBy, limit) { // Consulta por campos de documents\n        return new Promise(function (fulfill, reject) {\n            var result = [];\n            firebase.firestore().collection(collection).where(key, operator, value).orderBy(orderBy, \"desc\").limit(limit).get()\n                .then(function (querySnapshot) {\n                    querySnapshot.forEach(function (doc) {\n                        var data = doc.data();\n                        data.key = doc.id;\n                        result.push(data);\n                    });\n                    return fulfill(result);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.queryMultipleLimited = function(collection, keys, operators, values, limit){\n        return new Promise(function (fulfill, reject) {\n            var result = [];\n            var col = firebase.firestore().collection(collection);\n            for(var k in keys) // Concatenar multiples filtros\n                col = col.where(keys[k], operators[k], values[k])\n            col.limit(limit).get()\n                .then(function (querySnapshot) {\n                    querySnapshot.forEach(function (doc) {\n                        var data = doc.data();\n                        data.key = doc.id;\n                        result.push(data);\n                    });\n                    return fulfill(result);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n    \n})(middleware)","var app = angular.module('autotest', ['ngRoute', 'ngSanitize'])\n    .config([\"$routeProvider\", function ($routeProvider) {\n        $routeProvider\n            .when(\"/\", {\n                templateUrl: \"views/home.html\",\n                controller: \"home\"\n            })\n            .when(\"/autotest\", {\n                templateUrl: \"views/autotest.html\",\n                controller: \"autotest\",\n                resolve: { // Verificar que el usuario puede realizar el autotest\n                    check: ['$rootScope', '$location', function ($rootScope, $location) {\n                        if ($rootScope.testAllowed)\n                            $location.path('/autotest');\n                        else\n                            $location.path('/');\n                    }]\n                }\n            })\n            .when(\"/about\", {\n                templateUrl: \"views/about.html\"\n            })\n            .when(\"/contact_us\", {\n                templateUrl: \"views/contact_us.html\"\n            });\n    }])\n    .filter('trusted', ['$sce', function ($sce) {\n        // Ver: https://stackoverflow.com/questions/39480969/angular-interpolateinterr-error-when-adding-url-from-variable\n        return $sce.trustAsResourceUrl;\n    }])\n    .run([\"$rootScope\", function ($rootScope) {\n\n        // Inicializacion y componentes de F7\n        var f7 = new Framework7({ // Libreria de estilos\n            root: '#app',\n            name: 'Autotest COVID19 UNS',\n            id: 'com.autotest-covid-uns.test',\n            angular: true\n        });\n\n        $rootScope.showPreloader = function (message) { // Muestra un preloader mientras carga algunas operaciones\n            $rootScope.preloader = f7.dialog.preloader(message, \"blue\");\n        };\n\n        $rootScope.hidePreloader = function () { // Oculta el preloader si estaba abierto\n            if ($rootScope.preloader.opened)\n                $rootScope.preloader.close();\n        };\n\n        $rootScope.closePanel = function () {\n            f7.panel.close(document.getElementById(\"panel-menu\"), true);\n        };\n\n        $rootScope.showDialog = function(title, message, buttons){ // Mostrar un dialogo de confirmacion\n            f7.dialog.create({\n                title: title,\n                text: message,\n                buttons: buttons,\n                destroyOnClose: true\n            }).open();\n        };\n\n        $rootScope.toastSuccess = function (message, timeout, position) {\n            f7.toast.create({\n                text: message,\n                position: position || \"bottom\",\n                closeTimeout: timeout || 2000,\n                destroyOnClose: true,\n                cssClass: \"toast-success\"\n            }).open();\n        };\n        \n        $rootScope.toastError = function (message, timeout, position) {\n            f7.toast.create({\n                text: message,\n                position: position || \"bottom\",\n                closeTimeout: timeout || 2000,\n                destroyOnClose: true,\n                cssClass: \"toast-error\"\n            }).open();\n        };\n\n        $rootScope.userAllowed = false; // Bloquea al usuario si no esta dentro del circulo de acceso\n        $rootScope.testAllowed = false; // Admite el uso del autotest\n        $rootScope.firstTest = false; // Indica si es el primer test que realiza esa persona con ese DNI\n        \n        // Iniciar servicios de backend y descargar config\n        $rootScope.showPreloader(\"Cargando...\")\n        middleware.init()\n            .then(function (config) {\n                console.log(config);\n                $rootScope.config = config;\n                $rootScope.hidePreloader();\n\n                // Verificar que el usuario esta dentro del circulo de uso de la app\n                $rootScope.logData = {}; // Objeto que se va a cargar a la base de datos al finalizar el test\n                $rootScope.showPreloader(\"Determinando ubicación...\");\n                middleware.checkLocation($rootScope.config) // Obtener ubicacion del usuario (tambien descarga y actualiza configuracion)\n                    .then(function (result) { // Usuario dentro del rango\n                        $rootScope.hidePreloader();\n                        \n                        // Registrar ubicacion del usuario\n                        $rootScope.logData.lat = result.lat;\n                        $rootScope.logData.lng = result.lng;\n            \n                        $rootScope.userAllowed = true; // Habilitar completar formulario\n            \n                        $rootScope.toastSuccess(\"Su ubicación pertenece al área de estudio.\");\n                        $rootScope.$apply();\n                    })\n                    .catch(function (err) { // Usuario fuera del rango\n                        console.log(err);\n                        $rootScope.hidePreloader();\n                        $rootScope.toastError(\"Su ubicación está fuera del área de estudio.\");\n                        $rootScope.$apply();\n                    });\n            })\n            .catch(function (err) {\n                console.log(err);\n            });\n    }]);","app.controller(\"home\", ['$scope', '$rootScope', function ($scope, $rootScope) {\n    \n    //console.log(\"home\");\n    $rootScope.testAllowed = false; // Admite el uso del autotest\n\n    // Intentar recuperar los datos guardados\n    var localData = localStorage.getItem('userData');\n    console.log(localData);\n    if(localData)\n        $scope.userData = JSON.parse(localData);\n    else\n        $scope.userData = {};\n\n  \n    $scope.resetCheck = function(){ // Reinicia el estado del checkeo\n        $rootScope.testAllowed = false; // No se puede poner en el ng-change porque es variable de $root\n    };\n\n    $scope.checkForm = function () { // Validacion de formulario\n\n        if(!$rootScope.testAllowed){ // Solo realizar el chequeo mientras el usuario no fue habilitado\n            //console.log($scope.userData);\n\n            if (!$scope.userData) {\n                $rootScope.toastError(\"Debe completar su nombre\");\n                return;\n            }\n\n            if (!$scope.userData.name) {\n                $rootScope.toastError(\"Debe completar su nombre\");\n                return;\n            }\n\n            if (!$scope.userData.age) {\n                $rootScope.toastError(\"Por favor, indique su edad\");\n                return;\n            }\n\n            if (!$scope.userData.dni) {\n                $rootScope.toastError(\"Debe completar su DNI\");\n                return;\n            } else {\n                if ($scope.userData.dni < 100000) {\n                    $rootScope.toastError(\"Su DNI no parece un número válido\");\n                    return;\n                }\n            }\n\n            if (!$scope.userData.tel) {\n                $rootScope.toastError(\"Por favor, indique un teléfono\");\n                return;\n            }\n\n            if (!$scope.userData.gender) {\n                $rootScope.toastError(\"Debe indicar su género\");\n                return;\n            }\n\n            // Guardar formulario para que no tenga que recompletar\n            localStorage.setItem(\"userData\", JSON.stringify($scope.userData));\n\n            /* \n            * Si llega hasta aca, completo todos los datos. Verificar si ya cargo un test\n            * Si ya cargo, preguntar si desea modificar su respuesta con la opcion de salir o proceder.\n            * Puede cargar hasta 3 respuestas diferentes (?)\n            * Sino, pasar directamente al autotest\n            */\n\n            var allowAutotest = function(){ // Callback para dar el ok de iniciar el autotest\n                for(var k in $scope.userData) // Guardar los datos de usuario en objeto a registrar en DB\n                    $scope.logData[k] = $scope.userData[k];\n                $rootScope.testAllowed = true; // Habilitar usuario a realizar el test\n                $rootScope.toastSuccess(\"Habilitado para iniciar el autotest\", 1500, \"center\");\n                $rootScope.$apply();\n            };\n\n            $rootScope.showPreloader(\"Verificando datos...\");\n            middleware.fs.query(\"results\", \"dni\", \"==\", $scope.userData.dni, 3)\n            .then(function(results){\n                $rootScope.hidePreloader();\n                // Definir valores por defecto en caso de que la base de datos no traiga nada\n                var limits = {\n                    max: 3,\n                    elapsed: 86400000\n                };\n                if($rootScope.config)\n                    if($rootScope.config.logLimit)\n                        limits = { \n                            max: $rootScope.config.logLimit.max,\n                            elapsed: $rootScope.config.logLimit.elapsed\n                        };\n                if(results.length >= limits.max){ // Ya hay [max] registros guardados, no puede cargar mas\n                    $rootScope.showDialog(\"Límite de resultados\",\n                        \"El DNI indicado ya alcanzó el límite de \"+limits.max+\" autotests diferentes.\",\n                        [{text:\"Aceptar\"}]\n                    );\n                }else{\n                    if(results.length == 0){ // Si no hay resultados guardados para este dni, iniciar\n                        $rootScope.firstTest = true; // Testigo para habilitar contadores de estadistica\n                        allowAutotest();\n                    }else{ // Si hay entre 0 y 3 resultados, revisar fecha del ultimo\n                        // Obtener maximo\n                        var lastTimestamp = 0;\n                        for(var k in results){\n                            if(results[k].timestamp > lastTimestamp)\n                                lastTimestamp = results[k].timestamp;\n                        }\n                        if(Date.now() - lastTimestamp < limits.elapsed){\n                            $rootScope.showDialog(\"Límite de resultados\",\n                                \"Debe transcurrir \"+Math.round($rootScope.config.logLimit.elapsed/3600000)+\"hs. desde la última vez que realizó el autotest para realizar uno nuevo.\",\n                                [{text:\"Aceptar\"}]\n                            );\n                        }else{\n                            $rootScope.showDialog(\"Se encontraron registros\",\n                                \"El DNI indicado ya registró <b>\"+results.length+\"</b> resultado/s. Puede realizar un máximo de 3.\",\n                                [{\n                                    text: \"Aceptar\",\n                                    onClick: function() {\n                                        allowAutotest();\n                                    }\n                                }]\n                            );\n                        }\n                    }\n                }\n            })\n            .catch(function (err) { \n                console.log(err);\n                $rootScope.hidePreloader();\n                $rootScope.$apply();\n            });\n        }\n    };\n}]);","app.controller(\"autotest\", ['$scope', '$rootScope', function ($scope, $rootScope) {\n    \n    //console.log(\"autotest\");\n    \n    $rootScope.showPreloader(\"Obteniendo datos...\");\n    \n    $rootScope.logData.actionStack = []; // Registro de interacciones del usuario\n    \n    middleware.getTree() // Descargar config con diagrama de flujo\n    .then(function(config){\n        $rootScope.hidePreloader();\n\n        $scope.tree = config.tree;\n        $scope.current = config.tree[0];\n        $rootScope.logData.treeID = config.id; // Guardar el id del arbol\n        $rootScope.logData.actionStack.push({ // Registrar primer menu\n            index: \"0\",\n            timestamp: Date.now()\n        });\n\n        $rootScope.$apply();\n    })\n    .catch(function(err){\n        console.log(err);\n    });\n\n    $scope.loadMenu = function (index, exitCode) { // Callback de los botones\n        if(exitCode) // Registrar si hay codigo de finalizacion\n            $rootScope.logData.exitCode = exitCode;\n        if(index == -1){ // Indicador de finalizacion del test\n            $scope.endTest();\n        }else{ // Pasar a la siguiente vista\n            if ($scope.tree[index]){\n                $rootScope.logData.actionStack.push({\n                    index: index,\n                    timestamp: Date.now()\n                });\n                $scope.current = $scope.tree[index];\n            }\n        }\n    };\n\n    $scope.endTest = function(){ // Callback de finalizacion del test\n        $rootScope.logData.timestamp = Date.now(); // Estampa de tiempo de realizacion\n        \n        $rootScope.showPreloader(\"Enviando resultados...\");\n\n        // Incrementar contadores para estadistica \n        if($rootScope.firstTest){ // Para los datos que no cambian (edad, genero) se cuenta la primera vez\n            var age = $rootScope.logData.age;\n            var updAgeObj = {}; // Objeto de actualizacion\n            updAgeObj[\"range_\"+((age - age % 10)/10)] = firebase.firestore.FieldValue.increment(1); // incrementador de rango (range_0, range_1, ...)\n            \n            var updGndrObj = {}; // Objeto de actualizacion\n            updGndrObj[$rootScope.logData.gender] = firebase.firestore.FieldValue.increment(1);\n                \n            middleware.fs.update(updAgeObj,\"stats\",\"ages\");\n            middleware.fs.update(updGndrObj,\"stats\",\"genders\");\n        }\n\n        var updCodeObj = {}; // Objeto de actualizacion\n        updCodeObj[$rootScope.logData.exitCode] = firebase.firestore.FieldValue.increment(1);\n\n        var updPathObj = {};\n        updPathObj[$rootScope.logData.treeID] = {}; // Contadores de caminos para cada arbol\n        var path = \"P_0\";\n        for(var k = 1; k < $rootScope.logData.actionStack.length; k++){\n            path += \"_\"+$rootScope.logData.actionStack[k].index;\n            updPathObj[$rootScope.logData.treeID][path] = firebase.firestore.FieldValue.increment(1);\n            path = \"P_\"+$rootScope.logData.actionStack[k].index;\n        }\n        middleware.fs.update(updCodeObj,\"stats\",\"exitCodes\");\n        middleware.fs.update(updPathObj,\"stats\",\"paths\");\n\n\n        // Registrar objeto de resultado\n        middleware.fs.add($rootScope.logData, \"results\")\n            .then(function(){\n                // Fijar un mensaje\n                $scope.current = {\n                    header: \"Gracias por completar el test\",\n                    content: \"Si desea actualizar sus respuestas, puede repetir el test dentro de \"+Math.round($rootScope.config.logLimit.elapsed/3600000)+\" horas.\",\n                    options:[\n                        {\n                            text:\"Menú principal\",\n                            href:\"#!/\"\n                        }\n                    ]\n                };\n                $rootScope.hidePreloader();\n                $scope.$apply();\n            })\n            .catch(function(err){ // Si hay error en la carga del resultado, registrar problema en db\n                console.log(err);\n                // Indicar al usuario del error ocurrido\n                $scope.current = {\n                    header: \"El resultado no pudo registrarse\",\n                    content: \"Hemos enviado datos del problema para tabajar en la solución. Vuelva a intentarlo más tarde.\",\n                    options:[\n                        {\n                            text:\"Menú principal\",\n                            href:\"#!/\"\n                        }\n                    ]\n                };\n                var errorLog = {\n                    errMsg: JSON.stringify(err),\n                    timestamp: Date.now(),\n                    origin: \"autotest.js/$scope.endTest\"\n                };\n                middleware.fs.add(errorLog, \"errorLogs\")\n                    .then(function(){\n                        $rootScope.hidePreloader();\n                        $scope.$apply();\n                    })\n                    .catch(function(err2){ // Error en el registro de error ya es demasiado\n                        console.log(err2);\n                        $rootScope.hidePreloader();\n                        $scope.$apply();\n                    });\n            });\n    };\n}]);"],"sourceRoot":"/source/"}