{"version":3,"sources":["admin/custom/js/middleware.js","admin/custom/js/middleware-users.js","admin/custom/js/middleware-db.js","admin/custom/js/middleware-firestore.js","admin/custom/js/init.js","admin/controllers/login.js","admin/controllers/dashboard.js","admin/controllers/config.js"],"names":["window","middleware","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","public","init","Promise","fulfill","reject","firebase","initializeApp","auth","onAuthStateChanged","user","users","onUserSignedIn","uid","onUserSignedOut","e","console","log","signIn","form","signInWithEmailAndPassword","email","password","error","errorMessage","errorCode","code","then","result","signOut","signUp","createUserWithEmailAndPassword","fullfill","resetPwd","sendPasswordResetEmail","db","listen","path","callback_success","callback_error","database","ref","on","snapshot","val","key","listenChild","child","value","orderByChild","equalTo","stopListener","off","get","once","getSorted","getSortedLimited","limit","limitToLast","query","set","data","update","push","pushMultiple","dataArray","job","k","all","fs","add","collection","firestore","docRef","document","doc","getCollection","querySnapshot","getDocument","id","operator","theQuery","where","forEach","querySortedLimited","orderBy","queryMultipleLimited","keys","operators","values","col","app","angular","module","run","$rootScope","$location","userLogged","loading","configData","config","trees","tree","t","editable","$apply","err2","toastr","$scope","err","logout","getTime","stamp","format","time","Date","now","moment","fromNow","html2Text","content","temp","createElement","innerHTML","textContent","innerText","generateID","n","Math","random","toString","substr","showHelp","helpContent","$","modal","$routeProvider","when","templateUrl","controller","filter","$sce","trustAsResourceUrl","login","res","success","retrievePassword","info","updateAgePlot","labels","colors","grIncr","floor","Object","getOwnPropertyNames","stats","ages","length","gray","startAge","parseInt","split","endAge","agesChart","destroy","Chart","getElementById","type","datasets","label","backgroundColor","options","maintainAspectRatio","scales","yAxes","display","ticks","beginAtZero","updateGenderPlot","genderChart","pointRadius","genders","m","f","updaterResultPlot","exitCodes","exitCodeChart","updatePathsPlot","treeData","find","el","active","weights","maxWeight","pathStats","nodes","edges","nodeTitle","header","substring","shape","font","size","color","face","j","from","to","smooth","roundness","round","text","newId","exitCode","vis","DataSet","layout","hierarchical","direction","sortMethod","physics","align","arrows","enabled","scaleFactor","Network","updateStats","snapshot2","map","L","center","locationFilter","lat","lng","zoom","tileLayer","accessToken","addTo","latlng","newLocation","range","tempConfig","setupMap","current_location","marker","radius","circle","markerGroup","clearLayers","layerGroup","bindPopup","openPopup","updateLocationFilter","copy","updateTreePlot","newTree","author","currentUser","timestamp","setActiveTree","index","editTree","editingIndex","validateTree","status","goToNode","exit","message","testInDevice","activeIndex","findIndex","current","loadMenu","saveConfig","resetConfig","elapsedHours","logLimit","elapsed","updateElapsed"],"mappings":"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","file":"main-0eb4a7a743.js","sourcesContent":["window.middleware = (function () {\n\n    var firebaseConfig = { // Configuracion firebase\n        apiKey: \"AIzaSyDcBhhiu-dQXWaGBLcTEtnz8HPnelfXuA4\",\n        authDomain: \"covid19-autotest.firebaseapp.com\",\n        databaseURL: \"https://covid19-autotest.firebaseio.com\",\n        projectId: \"covid19-autotest\",\n        storageBucket: \"covid19-autotest.appspot.com\",\n        messagingSenderId: \"541298094681\",\n        appId: \"1:541298094681:web:a715a3322843f6ff7e7748\",\n        measurementId: \"G-0YZX1RVB1F\"\n    };\n\n    var DEBUG = true; // Version debugging\n\n    var public = {}; // Metodos y atributos publicos\n\n    public.init = function () { // Inicializacion del middleware. Descarga de configuracion\n        return new Promise(function (fulfill, reject) {\n            try {\n                firebase.initializeApp(firebaseConfig);\n\n                firebase.auth().onAuthStateChanged(function (user) { // Escuchar cambios de logeo de usuario\n                    if (user) // El usuario esta logeado\n                        public.users.onUserSignedIn(user.uid); // Pasar uid a los callbacks\n                    else // Si cerro sesión, se llama al callback\n                        public.users.onUserSignedOut();\n                });\n\n                return fulfill();\n            } catch (e) {\n                return reject(e);\n            }\n        });\n    };\n\n    return public;\n})();","(function (public) { // Extension de funciones middleware: auth\n\n    public.users = {}; // Metodos de autenticacion\n\n    public.users.onUserSignedIn = function (uid) { // Overridable - inicio de sesion\n        console.log(\"default -- logged in \" + uid);\n    };\n\n    public.users.onUserSignedOut = function () { // Overridable - cierre de sesion\n        console.log(\"default -- logged out\");\n    };\n\n    public.users.signIn = function (form) { // Iniciar sesión\n        return new Promise(function (fulfill, reject) {\n            firebase.auth().signInWithEmailAndPassword(form.email, form.password)\n                .catch(function (error) {\n                    var errorCode = error.code,\n                        errorMessage;\n                    switch (errorCode) {\n                        case 'auth/wrong-password':\n                            errorMessage = \"La contraseña es incorrecta.\";\n                            break;\n                        case 'auth/user-disabled':\n                            errorMessage = \"El usuario se haya inhabilitado momentáneamente.\";\n                            break;\n                        case 'auth/invalid-email':\n                            errorMessage = \"El email no es válido. Quizá esté mal escrito o no exista.\";\n                            break;\n                        case 'auth/user-not-found':\n                            errorMessage = \"El usuario no existe.\";\n                            break;\n                        default:\n                            errorMessage = \"Algo pasó.. revisa tu conexión a internet e intentálo nuevamente.\";\n                            break;\n                    }\n                    return reject([errorCode, errorMessage]);\n                })\n                .then(function (result) {\n                    return fulfill(\"Logeado correctamente.\");\n                });\n        });\n    };\n\n    public.users.signOut = function () {\n        return new Promise(function (fulfill, reject) {\n            firebase.auth().signOut()\n                .then(function () {\n                    return fulfill(\"Ha salido de la aplicación.\");\n                })\n                .catch(function (error) {\n                    return reject([error, \"Algo pasó.. intentálo nuevamente.\"]);\n                });\n        });\n    };\n\n    public.users.signUp = function (form) { // Registrarse como nuevo usuario\n        return new Promise(function (fulfill, reject) {\n            firebase.auth().createUserWithEmailAndPassword(form.email, form.password)\n                .catch(function (error) {\n                    var errorCode = error.code,\n                        errorMessage;\n                    switch (errorCode) {\n                        case 'auth/weak-password':\n                            errorMessage = \"La contraseña es demasiado débil. Intenta con una más segura.\";\n                            break;\n                        case 'auth/email-already-in-use':\n                            errorMessage = \"Éste email ya existe en nuestra base de datos.\";\n                            break;\n                        case 'auth/invalid-email':\n                            errorMessage = \"El email no es válido. Revisa lo ingresado.\";\n                            break;\n                        case 'auth/operation-not-allowed':\n                            errorMessage = \"No se puede crear la cuenta para ese usuario. Ponete en contacto con los administradores.\";\n                            break;\n                        default:\n                            errorMessage = \"Algo pasó... revisa tu conexión a internet e intentálo nuevamente.\";\n                            break;\n                    }\n                    return reject([errorCode, errorMessage]);\n                })\n                .then(function (result) {\n                    fullfill(result); // Registro exitoso, result.user.uid tiene el id generado para ese usuario\n                });\n        });\n    };\n\n    public.users.resetPwd = function (email) { // Restablecer contrasenia\n        return new Promise(function (fulfill, reject) {\n            firebase.auth().sendPasswordResetEmail(email)\n                .then(function () {\n                    return fulfill(\"Listo. Revisa tu correo electrónico.\");\n                })\n                .catch(function (error) {\n                    return reject([error, \"Algo pasó.. intentálo nuevamente.\"]);\n                });\n        });\n    };\n    \n})(middleware)","(function (public) { // Extension de funciones middleware: realtime database\n\n    public.db = {}; // Metodos de realtime database\n\n    public.db.listen = function (path, callback_success, callback_error) { // Escuchar cambios\n        firebase.database().ref(path).on('value',\n            function (snapshot) {\n                callback_success(snapshot.val(), snapshot.key);\n            },\n            function (error) {\n                callback_error(error);\n            });\n    };\n\n    public.db.listenChild = function(path, child, value, callback_success, callback_error) { // Escucha cambios con filtro\n        firebase.database().ref(path).orderByChild(child).equalTo(value).on('child_added',\n            function (snapshot) {\n                callback_success(snapshot.val(), snapshot.key);\n            },\n            function (error) {\n                callback_error(error);\n            });\n    };\n\n    public.db.stopListener = function(path){ // Detener escuchador\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).off()\n                .then(function () {\n                    return fulfill();\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.get = function (path) { // Descargar tabla de la db\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).once('value')\n                .then(function (snapshot) {\n                    return fulfill(snapshot.val());\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.getSorted = function (path, key) { // Obtener lista ordenada por key\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).orderByChild(key).once('value')\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.getSortedLimited = function (path, key, limit) { // Obtener lista ordenada por key y con limite de entradas\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).orderByChild(key).limitToLast(limit).once('value')\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.query = function(path, key, value) { // Consulta por valor\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).orderByChild(key).equalTo(value).once('value')\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.set = function (data, path) { // Actualizar entrada de la db\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).set(data)\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.update = function (data, path) { // Actualizar entrada de la db\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).update(data)\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.push = function (data, path) { // Nueva entrada (retorna id)\n        return new Promise(function (fulfill, reject) {\n            firebase.database().ref(path).push(data)\n                .then(function (snapshot) {\n                    return fulfill(snapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.db.pushMultiple = function (dataArray, path) { // Subir multiples entradas a un mismo directorio\n        return new Promise(function (fulfill, reject) {\n            var job = [];\n            for (var k in dataArray) // Para cada objeto \n                job.push(firebase.database().ref(path).push(dataArray[k])); // TODO: usar multiples paths \n            Promise.all(job) // Ejecutar promise\n                .then(function (snapshot) { // Snapshot es un array que contiene los keys\n                    return fulfill(snapshot); // Del otro lado se puede hacer un for para retornar\n                })\n                .catch(function (error) { // Ver si retorna un solo error o varios\n                    return reject(error);\n                });\n        });\n    };\n\n})(middleware);","(function(public){ // Extension de funciones middleware: firestore\n\n    public.fs = {}; // Metodos de firestore\n\n    public.fs.add = function (data, collection) { // Agregar un documento a la collection\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).add(data)\n                .then(function (docRef) {\n                    return fulfill(docRef); // docRef.id tiene el id del document cargado\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.set = function (data, collection, document) { // Asignar objeto al document de una collection\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).doc(document).set(data)\n                .then(function () {\n                    return fulfill();\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.update = function(data, collection, document) { // Actualizar datos existentes\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).doc(document).update(data)\n                .then(function () {\n                    return fulfill();\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.delete = function(collection, document) { // Actualizar datos existentes\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).doc(document).delete()\n                .then(function () {\n                    return fulfill();\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.getCollection = function (collection) { // Descargar collection\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).get()\n                .then(function (querySnapshot) {\n                    return fulfill(querySnapshot);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.getDocument = function(collection,document){\n        return new Promise(function (fulfill, reject) {\n            firebase.firestore().collection(collection).doc(document).get()\n                .then(function (querySnapshot) {\n                    var data = querySnapshot.data();\n                    data.key = querySnapshot.id;\n                    return fulfill(data);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n\n    ///// Consultas //////\n    // Los resultados retornan como arrays y las claves van como atributo \"key\" de cada elemento\n\n    public.fs.query = function (collection, key, operator, value, limit) { // Consulta por campos de documents\n        return new Promise(function (fulfill, reject) {\n            var result = [];\n            var theQuery;\n            if(limit)\n                theQuery = firebase.firestore().collection(collection).where(key, operator, value).limit(limit);\n            else\n                theQuery = firebase.firestore().collection(collection).where(key, operator, value);\n            \n            theQuery.get()\n                .then(function (querySnapshot) {\n                    querySnapshot.forEach(function (doc) {\n                        var data = doc.data();\n                        data.key = doc.id;\n                        result.push(data);\n                    });\n                    return fulfill(result);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.querySortedLimited = function (collection, key, operator, value, orderBy, limit) { // Consulta por campos de documents\n        return new Promise(function (fulfill, reject) {\n            var result = [];\n            firebase.firestore().collection(collection).where(key, operator, value).orderBy(orderBy, \"desc\").limit(limit).get()\n                .then(function (querySnapshot) {\n                    querySnapshot.forEach(function (doc) {\n                        var data = doc.data();\n                        data.key = doc.id;\n                        result.push(data);\n                    });\n                    return fulfill(result);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n\n    public.fs.queryMultipleLimited = function(collection, keys, operators, values, limit){\n        return new Promise(function (fulfill, reject) {\n            var result = [];\n            var col = firebase.firestore().collection(collection);\n            for(var k in keys) // Concatenar multiples filtros\n                col = col.where(keys[k], operators[k], values[k])\n            col.limit(limit).get()\n                .then(function (querySnapshot) {\n                    querySnapshot.forEach(function (doc) {\n                        var data = doc.data();\n                        data.key = doc.id;\n                        result.push(data);\n                    });\n                    return fulfill(result);\n                })\n                .catch(function (error) {\n                    return reject(error);\n                });\n        });\n    };\n    \n})(middleware)","var app = angular.module('autotest-admin', ['ngRoute', 'ngSanitize'])\n    .run([\"$rootScope\", \"$location\", function ($rootScope, $location) {\n\n        $rootScope.userLogged = false;\n        $rootScope.loading = true;\n\n        middleware.init();\n\n        $location.path('/login');\n\n        middleware.users.onUserSignedIn = function (uid) { // Callback usuario logeado\n            // Descargar configuracion actual\n            middleware.db.get(\"config\")\n                .then(function (configData) {\n\n                    $rootScope.config = configData;\n                    $rootScope.config.trees = [];\n\n                    // Arbol de decisiones en entrada aparte (y descarga por timestamp)\n                    middleware.db.getSorted(\"decisionTrees\", \"timestamp\")\n                        .then(function (snapshot) {\n                            snapshot.forEach(function (tree) {\n                                var t = tree.val();\n                                t.key = tree.key;\n                                t.editable = false; // Ningun arbol de la base de datos puede ser editado\n                                $rootScope.config.trees.push(t);\n                            });\n                            // Ir al tablero\n                            $rootScope.userLogged = true;\n                            $rootScope.loading = false;\n                            $location.path('/');\n                            $rootScope.$apply();\n                        })\n                        .catch(function (err2) {\n                            console.log(err2);\n                            toastr.error(\"Ocurrió un error al descargar la configuración global.\");\n                            $rootScope.loading = false;\n                            $scope.$apply();\n                        });\n                })\n                .catch(function (err) {\n                    console.log(err);\n                    toastr.error(\"Ocurrió un error al descargar la configuración global.\");\n                    $rootScope.loading = false;\n                    $scope.$apply();\n                });\n        };\n\n        middleware.users.onUserSignedOut = function () { // Callback usuario deslogeado\n            $rootScope.userLogged = false;\n            $rootScope.loading = false;\n            $location.path('/login');\n            $rootScope.$apply();\n        };\n\n        $rootScope.logout = function () {\n            $rootScope.loading = true;\n            middleware.users.signOut();\n        };\n\n\n        // Utils\n        $rootScope.getTime = function (stamp, format) { // Para ejecutar moment en view\n            var time;\n            if (!format) format = 3;\n            if (!stamp) format = 1;\n            switch (format) {\n                case 0: // Estampa de tiempo en view\n                    time = Date.now();\n                    break;\n                case 1: // Fecha y hora actual\n                    time = moment(Date.now()).format(\"DD/MM/YYYY HH:mm\");\n                    break;\n                case 2: // Solo fecha actual\n                    time = moment(Date.now()).format(\"DD/MM/YYYY\");\n                    break;\n                case 3: // Fecha y hora de argumento\n                    time = moment(stamp).format(\"DD/MM/YYYY HH:mm\");\n                    break;\n                case 4: // Solo fecha de argumento\n                    time = moment(stamp).format(\"DD/MM/YYYY\");\n                    break;\n                case 5: // Relativo al actual\n                    time = moment(stamp).fromNow();\n                    break;\n                case 6: // Fecha corta y hora\n                    time = moment(stamp).format(\"DD/MM HH:mm\");\n                    break;\n                default:\n                    time = null;\n            }\n            return time;\n        };\n\n        $rootScope.html2Text = function (content) { // Convierte contenido html en texto plano\n            var temp = document.createElement(\"div\");\n            temp.innerHTML = content;\n            return temp.textContent || temp.innerText || \"\";\n        };\n\n        $rootScope.generateID = function(n){\n            /**  https://gist.github.com/gordonbrander/2230317\n            * Math.random should be unique because of its seeding algorithm.\n            * Convert it to base 36 (numbers + letters), and grab the first n characters\n            * after the decimal.\n            */\n            return Math.random().toString(36).substr(2, n);\n        };\n\n        $rootScope.showHelp = function (ref) { // Ayuda en pantalla\n            switch (ref) {\n                case \"main-config\":\n                    $rootScope.helpContent = \"<p>Configure los parámetros de funcionamiento de la aplicación y presione \\\"Guardar\\\" para que la configuración tome efecto o \\\"Descartar\\\" para reestablecer los cambios a los valores activos.</p>\";\n                    break;\n                case \"map\":\n                    $rootScope.helpContent = \"<p>El mapa muestra el area de interés. Para modificar esta zona, pulse sobre el mapa y luego indique el radio del área.</p>\";\n                    break;\n                case \"log-limit\":\n                    $rootScope.helpContent = \"<p>Configure la cantidad de veces que un mismo usuario puede realizar el autotest y el tiempo que debe transcurrir entre cada resultado registrado en la base de datos</p>\";\n                    break;\n                case \"tree-list\":\n                    $rootScope.helpContent = \"<p>La lista muestra todos los árboles de decisión que fueron creados. Sólo un árbol por vez puede estar activo y una vez que se cargan los árboles a la base de datos ya no pueden volver a ser modificados.</p><p>Los nuevos árboles creados pueden modificarse múltiples veces antes de guardar la configuración global de este menú.</p>\";\n                    break;\n                case \"ages-plot\":\n                    $rootScope.helpContent = \"<p>El gráfico de barras muestra un histograma de edades de los usuarios. Sólo se contabiliza la edad luego del registro del primer resultado. Los rangos de edad del histograma se crean a medida que aparecen registros correspondientes a dichos intervalos.</p>\";\n                    break;\n                case \"genders-plot\":\n                    $rootScope.helpContent = \"<p>El gráfico circular muestra la proporción de usuarios por género. Sólo se contabiliza el género seleccionado luego del registro del primer resultado.</p>\";\n                    break;\n                case \"exitCodes-plot\":\n                    $rootScope.helpContent = \"<p>Cada opción de cada nodo del árbol de decisiones puede tener asociado un código de salida. Cada vez que el usuario selecciona dicha opción del menú, se contabiliza el código de salida correspondiente. El significado de cada código de salida es definido por el administrador al momento de diseñar el árbol de decisiones.</p>\";\n                    break;\n                case \"paths-plot\":\n                    $rootScope.helpContent = \"<p>El gráfico permite visualizar el árbol de decisiones actual donde el espesor de cada camino es proporcional a la cantidad de veces que un usuario pasó por ese camino.</p>\";\n                    break;\n                case \"tree-container\":\n                    $rootScope.helpContent = \"<p>El gráfico permite visualizar el árbol de decisiones activo. Puede arrastrar los nodos, desplazar la vista o hacer zoom.</p><p>Con el botón <i class='material-icons'>phone_android</i> de la derecha puede simular el comportamiento del arbol activo.</p>\";\n                    break;\n                default:\n                    $rootScope.helpContent = \"No se encontro la referencia\";\n                    break;\n            }\n            $(\"#help-modal\").modal('show');\n        }\n    }])\n    .config([\"$routeProvider\", function ($routeProvider) {\n        $routeProvider\n            .when(\"/dashboard\", {\n                templateUrl: \"views/dashboard.html\",\n                controller: \"dashboard\"\n            })\n            .when(\"/login\", {\n                templateUrl: \"views/login.html\",\n                controller: \"login\"\n            })\n            .when(\"/\", {\n                templateUrl: \"views/config.html\",\n                controller: \"config\"\n            });\n    }])\n    .filter('trusted', ['$sce', function ($sce) {\n        // Ver: https://stackoverflow.com/questions/39480969/angular-interpolateinterr-error-when-adding-url-from-variable\n        return $sce.trustAsResourceUrl;\n    }]);","app.controller(\"login\", ['$scope', '$rootScope', function ($scope, $rootScope) {\n    \n    $scope.login = function(){\n\n        if(!$scope.form){\n            toastr.error(\"Complete los campos de credenciales!\");\n            return;\n        }\n\n        if(!$scope.form.email){\n            toastr.error(\"Indique su usuario!\");\n            return;\n        }\n\n        if(!$scope.form.password){\n            toastr.error(\"Ingrese su contraseña!\");\n            return;\n        }\n\n        $rootScope.loading = true;\n        middleware.users.signIn($scope.form)\n        .then(function(res){\n            toastr.success(\"Bienvenido!\");\n        })\n        .catch(function(err){\n            console.log(err);\n            toastr.error(err[1]);\n            $rootScope.loading = false;\n            $scope.$apply();\n        });\n    };\n\n    $scope.retrievePassword = function(){\n        toastr.info(\"Pronto contaremos con esa funcionalidad.\");\n    };\n    \n}]);","app.controller(\"dashboard\", ['$scope', '$rootScope', '$location', function ($scope, $rootScope, $location) {\n\n    if (!$rootScope.userLogged) {\n        $location.path('/login');\n    }\n\n    var updateAgePlot = function () { // Grafico de barras con histograma de edades\n\n        var labels = [];\n        var data = [];\n        var colors = [];\n        var grIncr = Math.floor(200 / Object.getOwnPropertyNames($rootScope.stats.ages).length); // Incremento de color de cada barra\n        var gray = 5;\n        for (var k in $rootScope.stats.ages) {\n            var startAge = parseInt(k.split('_')[1]) * 10;\n            var endAge = startAge + 9;\n            labels.push(startAge + \"-\" + endAge);\n            data.push($rootScope.stats.ages[k]);\n            colors.push(\"rgba(\" + gray + \",\" + gray + \",\" + gray + \",0.9)\");\n            gray += grIncr;\n        }\n\n        if ($scope.agesChart)\n            $scope.agesChart.destroy();\n        $scope.agesChart = new Chart(document.getElementById(\"age-chart\"), {\n            type: 'bar',\n            data: {\n                labels: labels,\n                datasets: [{\n                    label: \"Usuarios por edad\",\n                    backgroundColor: colors,\n                    data: data,\n                }]\n            },\n            options: {\n                maintainAspectRatio: false,\n                scales: { // Para comenzar en 0\n                    yAxes: [{\n                        display: true,\n                        ticks: {\n                            beginAtZero: true\n                        }\n                    }]\n                }\n            }\n        });\n    };\n\n    var updateGenderPlot = function () { // Grafico de torta de porcentajes de generos\n        if ($scope.genderChart)\n            $scope.genderChart.destroy();\n        $scope.genderChart = new Chart(document.getElementById(\"gender-chart\"), {\n            type: 'doughnut',\n            data: {\n                labels: [\"Masculino\", \"Femenino\", \"Otro\"],\n                datasets: [{\n                    backgroundColor: [\"#333333\", \"#777777\", \"#AAAAAA\"],\n                    pointRadius: 0,\n                    data: [$rootScope.stats.genders.m, $rootScope.stats.genders.f, $rootScope.stats.genders.n],\n                }]\n            },\n            options: {\n                maintainAspectRatio: true\n            }\n        });\n    };\n\n    var updaterResultPlot = function () { // Grafico de código de resultados\n        \n        var labels = [];\n        var data = [];\n        var colors = [];\n        var grIncr = Math.floor(200 / Object.getOwnPropertyNames($rootScope.stats.exitCodes).length); // Incremento de color de cada barra\n        var gray = 5;\n        for (var k in $rootScope.stats.exitCodes) {\n            labels.push(k);\n            data.push($rootScope.stats.exitCodes[k]);\n            colors.push(\"rgba(\" + gray + \",\" + gray + \",\" + gray + \",0.9)\");\n            gray += grIncr;\n        }\n\n        if ($scope.exitCodeChart)\n            $scope.exitCodeChart.destroy();\n        $scope.exitCodeChart = new Chart(document.getElementById(\"exitCode-chart\"), {\n            type: 'bar',\n            data: {\n                labels: labels,\n                datasets: [{\n                    label: \"Código de resultado\",\n                    backgroundColor: colors,\n                    data: data,\n                }]\n            },\n            options: {\n                maintainAspectRatio: true,\n                scales: { // Comenzar en 0\n                    yAxes: [{\n                        display: true,\n                        ticks: {\n                            beginAtZero: true \n                        }\n                    }]\n                }\n            }\n        });\n    };\n\n    var updatePathsPlot = function () { // Grafico de sankey de interacciones de usuarios\n\n        // Determinar modelo activo\n        var treeData = $rootScope.config.trees.find(function (el) {\n            return el.active\n        });\n        var tree = treeData.tree;\n\n        //console.log($rootScope.pathStats[treeData.id]);\n        var weights = {};\n        var maxWeight = 0; // Para normalizar los valores\n        for (var k in $rootScope.pathStats[treeData.id]) {\n            if (!weights[k.split('_')[1]])\n                weights[k.split('_')[1]] = {};\n            weights[k.split('_')[1]][k.split('_')[2]] = $rootScope.pathStats[treeData.id][k];\n            if($rootScope.pathStats[treeData.id][k] > maxWeight)\n                maxWeight = $rootScope.pathStats[treeData.id][k];\n        }\n        console.log(weights);\n\n        var nodes = [];\n        var edges = [];\n\n        for (var k in tree) { // Crear cada nodo del arbol\n            var nodeTitle = tree[k].header.substring(0, 15)+\"-\\n\"+tree[k].header.substring(15, 30)+\"-\\n\"+tree[k].header.substring(30, 50);\n            nodes.push({\n                id: k,\n                value: 1,\n                label: \"[\" + k + \"] -- \" + $rootScope.html2Text(nodeTitle) + \"...\",\n                shape: \"box\",\n                font: {\n                    size: 12,\n                    color: \"white\",\n                    face: \"arial\"\n                },\n                color: \"#444444\" // Gris oscuro\n            });\n            for (var j in tree[k].options) { // Crear cada enlace (los enlaces externos no se grafican)\n                switch(tree[k].options[j].type){\n                    case \"goto\": // Enlace a otro nodo\n                        edges.push({\n                            from: k,\n                            to: tree[k].options[j].goto,\n                            smooth: {\n                                type: 'curvedCW',\n                                roundness: Math.random() - 0.5\n                            },\n                            value: Math.round(weights[k][tree[k].options[j].goto]/maxWeight*10) || 1,\n                            label: $rootScope.html2Text(tree[k].options[j].text).substring(0, 10) + \n                                (tree[k].options[j].text.length > 10 ? \"...\" : \"\") + \"\\n(\" + weights[k][tree[k].options[j].goto] + \")\"\n                        });\n                        break;\n                    case \"link\": // Enlace externo\n                        var newId = $rootScope.generateID(20); // Identificador unico\n                        nodes.push({ // Crear un nodo para mostrar el punto de finalizacion\n                            id: newId,\n                            value: 1,\n                            label: tree[k].options[j].text.substring(0, 8)+\"...\" || \"S/L\",\n                            shape: \"circle\",\n                            font: {\n                                size: 12,\n                                color: \"white\",\n                                face: \"arial\"\n                            },\n                            color: \"#AAAAAA\" // Gris claro\n                        });\n                        edges.push({ // Crear el enlace al nodo de salida\n                            from: k,\n                            to: newId,\n                            smooth: {\n                                type: 'curvedCW',\n                                roundness: Math.random() - 0.5\n                            },\n                            value: 1,\n                            label: \"Enlace ext.\"\n                        });\n                        break;\n                    case \"exit\": // Salida y reporte\n                        var newId = $rootScope.generateID(20); // Identificador unico\n                        nodes.push({ // Crear un nodo para mostrar el punto de finalizacion\n                            id: newId,\n                            value: 1,\n                            label: tree[k].options[j].exitCode || \"S/C\",\n                            shape: \"circle\",\n                            font: {\n                                size: 12,\n                                color: \"white\",\n                                face: \"arial\"\n                            },\n                            color: \"#AA0000\" // Rojo oscuro\n                        });\n                        edges.push({ // Crear el enlace al nodo de salida\n                            from: k,\n                            to: newId,\n                            smooth: {\n                                type: 'curvedCW',\n                                roundness: Math.random() - 0.5\n                            },\n                            value: 1,\n                            label: \"Cód. de salida\"\n                        });\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n        var data = {\n            nodes: new vis.DataSet(nodes),\n            edges: new vis.DataSet(edges)\n        };\n        console.log(data);\n        var options = {\n            layout: {\n                hierarchical: {\n                    direction: \"UD\",\n                    sortMethod: \"directed\"\n                }\n            },\n            physics:false,\n            edges: {\n                font: {\n                    size: 10,\n                    color: \"black\",\n                    face: \"arial\",\n                    align: 'top'\n                },\n                arrows: {\n                    to: {\n                        enabled: true,\n                        scaleFactor: 1\n                    }\n                }\n            },\n            nodes: {\n                shape: 'box'\n            }\n        };\n\n        var network = new vis.Network(document.getElementById('paths-container'), data, options);\n    };\n\n\n    $scope.updateStats = function () { // Las stats se descargan al acceder a este controller por unica vez durante el uso de la app\n        $rootScope.loading = true;\n        middleware.fs.getCollection(\"stats\")\n            .then(function (snapshot) {\n                $rootScope.stats = {}; // Objeto con contadores\n                snapshot.forEach(function (document) {\n                    $rootScope.stats[document.id] = document.data();\n                });\n\n                updateAgePlot();\n                updaterResultPlot();\n                updateGenderPlot();\n\n                middleware.fs.getCollection(\"pathStats\")\n                    .then(function (snapshot2) {\n                        $rootScope.pathStats = {};\n                        snapshot2.forEach(function (document) {\n                            $rootScope.pathStats[document.id] = document.data();\n                        });\n\n                        updatePathsPlot();\n\n                        $rootScope.loading = false;\n                        $scope.$apply();\n                    })\n                    .catch(function (err2) {\n                        console.log(err2);\n                        $rootScope.loading = false;\n                        $scope.$apply();\n                    });\n            })\n            .catch(function (err) {\n                console.log(err);\n                $rootScope.loading = false;\n                $scope.$apply();\n            });\n    };\n\n\n    if (!$rootScope.stats) // Descargar la 1ra vez\n        $scope.updateStats();\n    else { // Sino, directamente actualizar graficos\n        updateAgePlot();\n        updaterResultPlot();\n        updateGenderPlot();\n        updatePathsPlot();\n    }\n}]);","app.controller(\"config\", ['$scope', '$rootScope', function ($scope, $rootScope) {\n    \n    if(!$rootScope.userLogged){\n        $location.path('/login');\n    }\n    \n    // Iniciar mapa leaflet\n    $scope.map = L.map('map',{\n        center: [$rootScope.config.locationFilter.lat, $rootScope.config.locationFilter.lng],\n        zoom: 8,\n    });\n    \n    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\n        id: 'mapbox/streets-v11',\n        accessToken: 'pk.eyJ1IjoibWF0aWFzbWljaGVsZXR0byIsImEiOiJjazVsa2ZtamowZHJnM2ttaXFmZGo1MDhtIn0.8iBO-J1wj34LIqq-e4Me5w'\n    }).addTo($scope.map);\n\n    $scope.map.on('click', function(e){ // Callback de click\n        console.log(e.latlng);\n        $scope.newLocation = e.latlng;\n        $scope.newLocation.range = $scope.tempConfig.locationFilter.range;\n        $scope.$apply();\n        $(\"#location-modal\").modal(\"show\");\n    });\n\n    /*\n    $scope.map.on('locationfound', function (e) { // Callback de posicion GPS actualizada\n        console.log(e);\n    });\n    \n\n    // Mostrar ubicación actual\n    $scope.map.locate({\n        setView: true, // Forzar vista\n        maxZoom: 16 // Zoom\n    });\n    */\n\n    var setupMap = function(){  // Dibujar area de operacion\n        var current_location = { // Crear marcador\n            marker: L.marker($scope.tempConfig.locationFilter),\n            radius: L.circle($scope.tempConfig.locationFilter, $scope.tempConfig.locationFilter.range*1000) // Rango en metros\n        };\n\n        if($scope.markerGroup) $scope.markerGroup.clearLayers(); // Un marcador a la vez\n        \n        $scope.markerGroup = L.layerGroup().addTo($scope.map);\n\n        // Agregar marcador al mapa con su circulo de posicion estimada\n        current_location.marker.addTo($scope.markerGroup).bindPopup(\"Area de acceso a la aplicación\");\n        current_location.radius.addTo($scope.markerGroup);\n        current_location.marker.openPopup();\n    };\n\n    $scope.updateLocationFilter = function(){ // Callback para configurar nueva ubicacion\n        $scope.tempConfig.locationFilter = angular.copy($scope.newLocation);\n        setupMap();\n        toastr.success(\"Espacio de operación actualizado\");\n        $(\"#location-modal\").modal(\"hide\");\n    };\n\n\n    var updateTreePlot = function () { // Grafico de caminos recorridos\n        \n        var treeData = $scope.tempConfig.trees.find(function(el){return el.active});\n        var tree = treeData.tree;\n        \n        var nodes = [];\n        var edges = [];\n\n        for (var k in tree) { // Crear cada nodo del arbol\n            var nodeTitle = tree[k].header.substring(0, 15)+\"-\\n\"+tree[k].header.substring(15, 30)+\"-\\n\"+tree[k].header.substring(30, 50);\n            nodes.push({\n                id: k,\n                value: 1,\n                label: \"[\"+k+\"] -- \"+ $rootScope.html2Text(nodeTitle)+\"...\",\n                shape:\"box\",\n                font: { \n                    size: 12, \n                    color: \"white\", \n                    face: \"arial\"\n                },\n                color: \"#444444\" // Gris oscuro\n            });\n            for (var j in tree[k].options) { // Crear cada enlace\n                switch(tree[k].options[j].type){\n                    case 'goto':\n                        edges.push({\n                            from: k,\n                            to: tree[k].options[j].goto,\n                            smooth: {\n                                type: 'curvedCW',\n                                roundness: Math.random() - 0.5\n                            },\n                            label: $rootScope.html2Text(tree[k].options[j].text).substring(0, 10) + (tree[k].options[j].text.length > 10 ? \"...\" : \"\")\n                        });\n                        break;\n                    case 'link':\n                        var newId = $rootScope.generateID(20); // Identificador unico\n                        nodes.push({ // Crear un nodo para mostrar el enlace externo\n                            id: newId,\n                            label: tree[k].options[j].text.substring(0, 8)+\"...\" || \"S/L\",\n                            shape: \"circle\",\n                            font: {\n                                size: 12,\n                                color: \"white\",\n                                face: \"arial\"\n                            },\n                            color: \"#AAAAAA\" // Gris claro\n                        });\n                        edges.push({ // Crear el enlace al nodo de salida\n                            from: k,\n                            to: newId,\n                            smooth: {\n                                type: 'curvedCW',\n                                roundness: Math.random() - 0.5\n                            },\n                            label: \"Enlace ext.\"\n                        });\n                        break;\n                    case 'exit':\n                        var newId = $rootScope.generateID(20); // Identificador unico\n                        nodes.push({ // Crear un nodo para mostrar el punto de finalizacion\n                            id: newId,\n                            label: tree[k].options[j].exitCode || \"S/C\",\n                            shape: \"circle\",\n                            font: {\n                                size: 12,\n                                color: \"white\",\n                                face: \"arial\"\n                            },\n                            color: \"#AA0000\" // Rojo oscuro\n                        });\n                        edges.push({ // Crear el enlace al nodo de salida\n                            from: k,\n                            to: newId,\n                            smooth: {\n                                type: 'curvedCW',\n                                roundness: Math.random() - 0.5\n                            },\n                            label: \"Cód. de salida\"\n                        });\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n        var data = {\n            nodes: nodes,\n            edges: edges\n        };\n        console.log(data);\n        var options = {\n            layout: {\n                hierarchical: {\n                  direction: \"UD\",\n                  sortMethod: \"directed\"\n                }\n            },\n            physics: false,\n            edges: {\n                font: {\n                    size: 10,\n                    color: \"black\",\n                    face: \"arial\",\n                    align: 'top'\n                },\n                arrows: {\n                    to: {\n                        enabled: true,\n                        scaleFactor: 1\n                    }\n                }\n            },\n            nodes: {\n                shape: 'box'\n            }\n        };\n        // Hacer destroy para actualizar?\n        var network = new vis.Network(document.getElementById('tree-container'), data, options);\n    };\n\n    $scope.newTree = function(){ // Crear un nuevo arbol vacio\n        toastr.success(\"Nuevo arbol creado\");\n        var newTree = {\n            author: firebase.auth().currentUser.email,\n            id: \"T00\"+($scope.tempConfig.trees.length+1),\n            timestamp: Date.now(),\n            editable: true, // Antes de cargarse a la db, puede ser editado\n            tree: [{ // Crearlo con un solo nodo\n                header:\"\",\n                content:\"\",\n                options:[] // Sin opciones\n            }]\n        };\n        $scope.tempConfig.trees.push(newTree);\n    };\n\n    $scope.setActiveTree = function(index){ // Configurar arbol de la lista como activo\n        for(var k in $scope.tempConfig.trees){\n            if(k == index)\n                $scope.tempConfig.trees[k].active = true;\n            else\n                $scope.tempConfig.trees[k].active = false;\n        }\n        updateTreePlot();\n    };\n\n    $scope.editTree = function(index){ // Editar un arbol recientemente creado\n        $scope.editingIndex = index; // Tomar indice para mostrar arbol en la vista\n        $(\"#tree-edit-modal\").modal(\"show\");\n    };\n\n    $scope.validateTree = function(){ // Verifica el arbol creado: busca lazos infinitos y reconfigura modelo\n\n        // Evaluar modelo para buscar lazos infinitos o nodos sin salida\n        var tree = $scope.tempConfig.trees[$scope.editingIndex].tree;\n\n        var goToNode = function(index){ // Recorrer todo el arbol\n            var exit = false; // Indica si se encuentra opcion de salida en el nodo actual\n            for(var k in tree[index].options){ // Para cada enlace del nodo actual\n                if(tree[index].options[k].type==\"goto\"){ // Enlace a nodo\n                    exit = true; // Si puede saltar a otro nodo, hay salida\n                    var status = goToNode(tree[index].options[k].goto); // Evaluar ese nodo\n                    if(status != \"ok\") // Si ya se detecto error\n                        return status; // Retornar por backtrack\n                }\n                if(tree[index].options[k].type==\"exit\" && tree[index].options[k].exitCode) // Opcion de salida\n                    exit = true; // Este nodo tiene al menos una condicion de salida\n            }\n            if(!exit) return \"exit\"; // Si ningun nodo permite salir o pasar a otro nodo, es arbol sin salida\n            return \"ok\";\n        }\n    \n        var status;\n        try{ // Si hay lazos sin salida, se llena el stack\n            status = goToNode(0); // Iniciar el recorrido por el nodo 0\n        }catch(e){\n            console.log(e.message);\n            status = \"loop\";\n        }\n    \n        switch(status){\n            case \"exit\":\n                console.log(\"Se detectaron nodos sin salida.\");\n                toastr.error(\"El arbol tiene nodos sin salida\");\n                break;\n            case \"loop\":\n                console.log(\"Se detectaron lazos infinitos.\");\n                toastr.error(\"El arbol tiene lazos infinitos o hay nodos mal referenciados\");\n                break;\n            case \"ok\":\n                console.log(\"Arbol correcto\");\n                toastr.success(\"Arbol correcto\");\n                $(\"#tree-edit-modal\").modal(\"hide\");\n                break;\n            default:\n                break;\n        }\n        updateTreePlot(); // Actualizar la visualizacion\n    };\n\n    $scope.testInDevice = function(){ // Iniciar dispositivo para probar modelo activo\n\n        $scope.activeIndex = $scope.tempConfig.trees.findIndex(function(el){return el.active});\n        $scope.current = $scope.tempConfig.trees[$scope.activeIndex].tree[0];\n\n        $scope.loadMenu = function (index) { // Callback de botones con enlace a sgte nodo\n            if(index > 0){ // Pasar a la siguiente vista\n                if ($scope.tempConfig.trees[$scope.activeIndex].tree[index]) // Control\n                    $scope.current = $scope.tempConfig.trees[$scope.activeIndex].tree[index];\n            }\n        };\n\n        $scope.exit = function(code){ // Finalizacion del test\n            toastr.info(\"Codigo de finalización: \"+code);\n            $(\"#app-test-modal\").modal(\"hide\");\n        };\n        \n        $(\"#app-test-modal\").modal(\"show\");\n    };\n\n    $scope.saveConfig = function(){ // Cuando el admin confirma aplicar la configuracion actual a la base de datos, se sobre escribe toda la configuracion\n\n        // Deshabilitar edicion de todos los arboles\n        for(var k in $scope.tempConfig.trees){\n            delete $scope.tempConfig.trees[k].editable;\n        }\n        \n        \n        $rootScope.config = angular.copy($scope.tempConfig);\n        $(\"#confirm-modal\").modal(\"hide\");\n\n        // TODO: cargar a firebase\n        console.log(\"Actualizar config\");\n        console.log($rootScope.config);\n    };\n\n    $scope.resetConfig = function(){ // Reestablecer el modelo que se muestra en la vista al de la base de datos\n        $scope.tempConfig = angular.copy($rootScope.config);\n        $scope.elapsedHours = $scope.tempConfig.logLimit.elapsed/3600000; // Convertir de milisegundos a horas\n        setupMap();\n        updateTreePlot();\n    };\n\n    $scope.updateElapsed = function(){ // Callback de cambios en el input del limitador de usos\n        $scope.tempConfig.logLimit.elapsed = $scope.elapsedHours*3600000; // Convertir de horas a milisegundos\n    };\n    \n    $scope.resetConfig();\n}]);"],"sourceRoot":"/source/"}